<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∑–∞—â–∏—Ç–Ω–∏–∫</title>
    
    <!-- –î–û–ë–ê–í–ò–ú –í–ï–†–°–ò–Æ –í CSS –ò JS –î–õ–Ø –ë–û–†–¨–ë–´ –° –ö–≠–®–ï–ú -->
    <style id="game-styles">
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        * { 
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #000;
            font-family: Arial, sans-serif;
        }
        
        /* –≠–ö–†–ê–ù–´ */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: linear-gradient(135deg, #0a0a2a, #1a1a4a);
            color: white;
            padding: 15px;
        }
        
        .screen.active {
            display: flex;
        }
        
        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        .game-title {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .game-title h1 {
            color: #00ffcc;
            font-size: 28px;
            text-shadow: 0 0 10px #00ffcc;
            margin-bottom: 10px;
        }
        
        .game-title p {
            color: #aaa;
            font-size: 16px;
        }
        
        /* –ö–ù–û–ü–ö–ò –ú–ï–ù–Æ */
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto 40px;
        }
        
        .menu-btn {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .menu-btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0066ff, #0099ff);
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        /* –ò–ù–§–û –û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï –ò –†–ï–ö–û–†–î */
        .user-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 20px;
            text-align: center;
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .high-score {
            color: #ffcc00;
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .stats {
            display: flex;
            gap: 25px;
        }
        
        .stat {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat.lives { color: #ff3366; }
        .stat.score { color: #00ffcc; }
        .stat.time { color: #ffcc00; }
        
        /* –ò–ì–†–û–í–ê–Ø –û–ë–õ–ê–°–¢–¨ */
        #gameContainer {
            flex: 1;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï - –ü–†–û–°–¢–´–ï –ö–ù–û–ü–ö–ò */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .control-btn {
            padding: 25px 15px;
            border: none;
            border-radius: 15px;
            font-size: 24px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }
        
        .fire-btn {
            background: linear-gradient(135deg, #ff3366, #ff0066);
            font-size: 20px;
            font-weight: bold;
        }
        
        .menu-btn-game {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            margin-top: 15px;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* –ò–ù–°–¢–†–£–ö–¶–ò–ò */
        .instructions-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            max-width: 400px;
        }
        
        .instruction {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .instruction-icon {
            width: 50px;
            height: 50px;
            background: rgba(0, 255, 204, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            color: #00ffcc;
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-height: 700px) {
            .game-title h1 { font-size: 24px; }
            .menu-btn { padding: 15px; }
            .control-btn { padding: 20px 10px; font-size: 20px; }
        }
        
        @media (orientation: landscape) {
            #gameScreen {
                flex-direction: row;
                padding: 10px;
            }
            
            .game-header {
                flex-direction: column;
                width: 120px;
                margin-right: 10px;
                margin-bottom: 0;
                justify-content: flex-start;
                gap: 20px;
            }
            
            .stats {
                flex-direction: column;
                gap: 20px;
            }
            
            #gameContainer {
                margin-bottom: 0;
                margin-right: 10px;
            }
            
            .controls {
                width: 120px;
                grid-template-columns: 1fr;
            }
            
            .menu-btn-game {
                width: 120px;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="menuScreen" class="screen active">
        <div class="game-title">
            <h1><span style="font-size: 40px;">üöÄ</span><br>–ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –ó–ê–©–ò–¢–ù–ò–ö</h1>
            <p>–ó–∞—â–∏—Ç–∏ –ø–ª–∞–Ω–µ—Ç—É –æ—Ç –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤!</p>
        </div>
        
        <div class="menu-buttons">
            <button class="menu-btn btn-primary" onclick="startGame()">
                <span style="font-size: 24px;">‚ñ∂Ô∏è</span> –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
            </button>
            <button class="menu-btn btn-secondary" onclick="showScreen('howToScreen')">
                <span style="font-size: 24px;">‚ùì</span> –ö–ê–ö –ò–ì–†–ê–¢–¨
            </button>
        </div>
        
        <div class="user-info">
            <p>üéÆ –í–ï–†–°–ò–Ø: <span id="gameVersion">2.0</span></p>
            <p class="high-score">üèÜ –†–ï–ö–û–†–î: <span id="highScoreDisplay">0</span></p>
            <p style="font-size: 12px; color: #aaa; margin-top: 10px;">
                –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="lastUpdate">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
            </p>
        </div>
    </div>

    <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <div class="stats">
                <div class="stat lives">
                    <span style="font-size: 24px;">‚ù§Ô∏è</span> <span id="lives">3</span>
                </div>
                <div class="stat score">
                    <span style="font-size: 24px;">‚≠ê</span> <span id="score">0</span>
                </div>
                <div class="stat time">
                    <span style="font-size: 24px;">‚è±Ô∏è</span> <span id="time">60</span>—Å
                </div>
            </div>
        </div>
        
        <div id="gameContainer">
            <canvas id="gameCanvas"></canvas>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="leftBtn">
                <span style="font-size: 32px;">‚Üê</span>
            </button>
            
            <button class="control-btn fire-btn" id="fireBtn">
                <span style="font-size: 28px;">üî•</span><br>–û–ì–û–ù–¨
            </button>
            
            <button class="control-btn" id="rightBtn">
                <span style="font-size: 32px;">‚Üí</span>
            </button>
        </div>
        
        <button class="menu-btn-game" onclick="returnToMenu()">
            <span style="font-size: 24px;">üè†</span> –í –ú–ï–ù–Æ
        </button>
    </div>

    <!-- –≠–ö–†–ê–ù –ò–ù–°–¢–†–£–ö–¶–ò–ô -->
    <div id="howToScreen" class="screen">
        <div class="game-title">
            <h1><span style="font-size: 40px;">üéÆ</span><br>–ö–ê–ö –ò–ì–†–ê–¢–¨</h1>
        </div>
        
        <div class="instructions-container">
            <div class="instruction">
                <div class="instruction-icon">‚Üê</div>
                <div>
                    <strong>–î–í–ò–ñ–ï–ù–ò–ï –í–õ–ï–í–û</strong>
                    <p>–ù–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É</p>
                </div>
            </div>
            
            <div class="instruction">
                <div class="instruction-icon">‚Üí</div>
                <div>
                    <strong>–î–í–ò–ñ–ï–ù–ò–ï –í–ü–†–ê–í–û</strong>
                    <p>–ù–∞–∂–º–∏—Ç–µ –ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É</p>
                </div>
            </div>
            
            <div class="instruction">
                <div class="instruction-icon">üî•</div>
                <div>
                    <strong>–°–¢–†–ï–õ–¨–ë–ê</strong>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –û–ì–û–ù–¨</p>
                </div>
            </div>
            
            <div class="instruction">
                <div class="instruction-icon">üí•</div>
                <div>
                    <strong>–ò–ó–ë–ï–ì–ê–ô–¢–ï –ê–°–¢–ï–†–û–ò–î–û–í</strong>
                    <p>–£ –≤–∞—Å 3 –∂–∏–∑–Ω–∏</p>
                </div>
            </div>
        </div>
        
        <div class="menu-buttons">
            <button class="menu-btn btn-primary" onclick="showScreen('menuScreen')">
                <span style="font-size: 24px;">‚Üê</span> –ù–ê–ó–ê–î –í –ú–ï–ù–Æ
            </button>
        </div>
    </div>

    <script>
        // ========== –§–ò–ö–° –î–õ–Ø –ö–≠–®–ê ==========
        // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –≤ URL —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –∫—ç—à
        const VERSION = '2.1-' + Date.now();
        document.getElementById('gameVersion').textContent = VERSION.split('-')[0];
        document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
        document.getElementById('game-styles').setAttribute('data-version', VERSION);
        
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let gameState = {
            screen: 'menu',
            score: 0,
            lives: 3,
            time: 60,
            isPlaying: false,
            highScore: 0
        };
        
        let gameObjects = {
            player: { x: 0, y: 0, width: 40, height: 60, speed: 6 },
            bullets: [],
            asteroids: [],
            explosions: []
        };
        
        let controls = {
            left: false,
            right: false
        };
        
        let canvas, ctx;
        let animationId = null;
        let gameInterval = null;
        let asteroidInterval = null;
        let timerInterval = null;

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
        function showScreen(screenId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById(screenId + 'Screen').classList.add('active');
            gameState.screen = screenId;
            
            // –ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –º–µ–Ω—é - –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–µ–∫–æ—Ä–¥
            if (screenId === 'menu') {
                loadHighScore();
            }
            
            // –ï—Å–ª–∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ –∏–≥—Ä—ã - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—ë
            if (screenId !== 'game') {
                stopGame();
            }
        }
        
        function startGame() {
            showScreen('game');
            initGame();
        }
        
        function returnToMenu() {
            stopGame();
            showScreen('menu');
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ==========
        function initGame() {
            // –ü–æ–ª—É—á–∞–µ–º canvas
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
            resizeCanvas();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            resetGame();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            setupControls();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
            startGameLoops();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateGameUI();
        }
        
        function resetGame() {
            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
            gameObjects.player.x = (canvas.width - gameObjects.player.width) / 2;
            gameObjects.player.y = canvas.height - gameObjects.player.height - 20;
            
            // –û—á–∏—â–∞–µ–º –º–∞—Å—Å–∏–≤—ã
            gameObjects.bullets = [];
            gameObjects.asteroids = [];
            gameObjects.explosions = [];
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            gameState.score = 0;
            gameState.lives = 3;
            gameState.time = 60;
            gameState.isPlaying = true;
            
            // –°–±—Ä–æ—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            controls.left = false;
            controls.right = false;
        }
        
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞
            const baseSize = Math.min(40, canvas.width * 0.1);
            gameObjects.player.width = baseSize;
            gameObjects.player.height = baseSize * 1.5;
            gameObjects.player.speed = canvas.width * 0.02;
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
        function setupControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const fireBtn = document.getElementById('fireBtn');
            
            // –õ–ï–í–ê–Ø –ö–ù–û–ü–ö–ê
            leftBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                controls.left = true;
                leftBtn.style.background = 'rgba(255, 255, 255, 0.3)';
            });
            
            leftBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                controls.left = false;
                leftBtn.style.background = '';
            });
            
            leftBtn.addEventListener('mousedown', () => {
                controls.left = true;
                leftBtn.style.background = 'rgba(255, 255, 255, 0.3)';
            });
            
            leftBtn.addEventListener('mouseup', () => {
                controls.left = false;
                leftBtn.style.background = '';
            });
            
            leftBtn.addEventListener('mouseleave', () => {
                controls.left = false;
                leftBtn.style.background = '';
            });
            
            // –ü–†–ê–í–ê–Ø –ö–ù–û–ü–ö–ê
            rightBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                controls.right = true;
                rightBtn.style.background = 'rgba(255, 255, 255, 0.3)';
            });
            
            rightBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                controls.right = false;
                rightBtn.style.background = '';
            });
            
            rightBtn.addEventListener('mousedown', () => {
                controls.right = true;
                rightBtn.style.background = 'rgba(255, 255, 255, 0.3)';
            });
            
            rightBtn.addEventListener('mouseup', () => {
                controls.right = false;
                rightBtn.style.background = '';
            });
            
            rightBtn.addEventListener('mouseleave', () => {
                controls.right = false;
                rightBtn.style.background = '';
            });
            
            // –ö–ù–û–ü–ö–ê –û–ì–û–ù–¨
            fireBtn.addEventListener('click', shoot);
            
            // –ö–õ–ê–í–ò–ê–¢–£–†–ê (–¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') controls.left = true;
                if (e.key === 'ArrowRight') controls.right = true;
                if (e.key === ' ' || e.key === 'Spacebar') {
                    e.preventDefault();
                    shoot();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft') controls.left = false;
                if (e.key === 'ArrowRight') controls.right = false;
            });
            
            // –†–ï–°–ê–ô–ó
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('orientationchange', () => {
                setTimeout(resizeCanvas, 100);
            });
        }
        
        function shoot() {
            if (!gameState.isPlaying) return;
            
            gameObjects.bullets.push({
                x: gameObjects.player.x + gameObjects.player.width / 2,
                y: gameObjects.player.y,
                width: 5,
                height: 15
            });
        }

        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function gameLoop() {
            if (!gameState.isPlaying) return;
            
            // –û–ë–ù–û–í–õ–ï–ù–ò–ï
            updateGame();
            
            // –û–¢–†–ò–°–û–í–ö–ê
            drawGame();
            
            // –°–õ–ï–î–£–Æ–©–ò–ô –ö–ê–î–†
            animationId = requestAnimationFrame(gameLoop);
        }
        
        function updateGame() {
            // –î–í–ò–ñ–ï–ù–ò–ï –ò–ì–†–û–ö–ê
            if (controls.left) {
                gameObjects.player.x = Math.max(0, gameObjects.player.x - gameObjects.player.speed);
            }
            if (controls.right) {
                gameObjects.player.x = Math.min(
                    canvas.width - gameObjects.player.width,
                    gameObjects.player.x + gameObjects.player.speed
                );
            }
            
            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–£–õ–¨
            for (let i = gameObjects.bullets.length - 1; i >= 0; i--) {
                gameObjects.bullets[i].y -= 8;
                
                if (gameObjects.bullets[i].y < 0) {
                    gameObjects.bullets.splice(i, 1);
                }
            }
            
            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ê–°–¢–ï–†–û–ò–î–û–í
            for (let i = gameObjects.asteroids.length - 1; i >= 0; i--) {
                const asteroid = gameObjects.asteroids[i];
                asteroid.y += asteroid.speed;
                
                // –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ï –° –ò–ì–†–û–ö–û–ú
                if (checkCollision(gameObjects.player, asteroid)) {
                    gameState.lives--;
                    createExplosion(asteroid.x, asteroid.y, asteroid.size);
                    gameObjects.asteroids.splice(i, 1);
                    updateGameUI();
                    
                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                    continue;
                }
                
                // –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ï –° –ü–£–õ–Ø–ú–ò
                for (let j = gameObjects.bullets.length - 1; j >= 0; j--) {
                    if (checkCollision(gameObjects.bullets[j], asteroid)) {
                        gameState.score += 10;
                        createExplosion(asteroid.x, asteroid.y, asteroid.size);
                        gameObjects.asteroids.splice(i, 1);
                        gameObjects.bullets.splice(j, 1);
                        updateGameUI();
                        
                        // –ü–†–û–í–ï–†–Ø–ï–ú –†–ï–ö–û–†–î –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
                        checkHighScore();
                        break;
                    }
                }
                
                // –£–î–ê–õ–ï–ù–ò–ï –ó–ê –≠–ö–†–ê–ù–û–ú
                if (asteroid.y > canvas.height) {
                    gameObjects.asteroids.splice(i, 1);
                }
            }
            
            // –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–ó–†–´–í–û–í
            for (let i = gameObjects.explosions.length - 1; i >= 0; i--) {
                gameObjects.explosions[i].life--;
                if (gameObjects.explosions[i].life <= 0) {
                    gameObjects.explosions.splice(i, 1);
                }
            }
        }
        
        function drawGame() {
            // –§–û–ù
            ctx.fillStyle = 'rgba(10, 10, 30, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ó–í–ï–ó–î–´
            drawStars();
            
            // –ò–ì–†–û–ö
            drawPlayer();
            
            // –ü–£–õ–ò
            gameObjects.bullets.forEach(bullet => {
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(bullet.x - 2, bullet.y, 5, 15);
                
                // –°–í–ï–ß–ï–ù–ò–ï
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#ffff00';
                ctx.fillRect(bullet.x - 2, bullet.y, 5, 15);
                ctx.shadowBlur = 0;
            });
            
            // –ê–°–¢–ï–†–û–ò–î–´
            gameObjects.asteroids.forEach(asteroid => {
                ctx.fillStyle = '#888888';
                ctx.beginPath();
                ctx.arc(asteroid.x, asteroid.y, asteroid.size, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // –í–ó–†–´–í–´
            gameObjects.explosions.forEach(explosion => {
                const alpha = explosion.life / 20;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = '#ff6600';
                ctx.beginPath();
                ctx.arc(explosion.x, explosion.y, explosion.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });
        }
        
        function drawStars() {
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 50; i++) {
                const x = (i * 7.3) % canvas.width;
                const y = (i * 3.1) % canvas.height;
                const size = Math.random() * 1.5;
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawPlayer() {
            const p = gameObjects.player;
            
            // –ö–û–†–ü–£–°
            ctx.fillStyle = '#00ccff';
            ctx.beginPath();
            ctx.moveTo(p.x + p.width/2, p.y);
            ctx.lineTo(p.x, p.y + p.height);
            ctx.lineTo(p.x + p.width, p.y + p.height);
            ctx.closePath();
            ctx.fill();
            
            // –ö–ê–ë–ò–ù–ê
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(p.x + p.width/2, p.y + p.height/3, p.width/4, 0, Math.PI * 2);
            ctx.fill();
            
            // –î–í–ò–ì–ê–¢–ï–õ–¨
            ctx.fillStyle = '#ff6600';
            ctx.fillRect(p.x + p.width/4, p.y + p.height, p.width/2, 10);
        }
        
        function createExplosion(x, y, size) {
            gameObjects.explosions.push({
                x: x,
                y: y,
                size: size * 1.5,
                life: 20
            });
        }
        
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.size * 2 &&
                   obj1.x + (obj1.width || 10) > obj2.x &&
                   obj1.y < obj2.y + obj2.size * 2 &&
                   (obj1.height || 10) + obj1.y > obj2.y;
        }

        // ========== –ò–ì–†–û–í–´–ï –ò–ù–¢–ï–†–í–ê–õ–´ ==========
        function startGameLoops() {
            // –û–°–ù–û–í–ù–û–ô –ò–ì–†–û–í–û–ô –¶–ò–ö–õ
            if (animationId) cancelAnimationFrame(animationId);
            animationId = requestAnimationFrame(gameLoop);
            
            // –°–û–ó–î–ê–ù–ò–ï –ê–°–¢–ï–†–û–ò–î–û–í
            if (asteroidInterval) clearInterval(asteroidInterval);
            asteroidInterval = setInterval(() => {
                if (!gameState.isPlaying) return;
                
                const size = 15 + Math.random() * 20;
                gameObjects.asteroids.push({
                    x: Math.random() * (canvas.width - size * 2),
                    y: -size,
                    size: size,
                    speed: 1 + Math.random() * 3
                });
            }, 1000);
            
            // –¢–ê–ô–ú–ï–†
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(timerInterval);
                    return;
                }
                
                gameState.time--;
                updateGameUI();
                
                if (gameState.time <= 0) {
                    gameOver();
                }
            }, 1000);
        }
        
        function stopGame() {
            gameState.isPlaying = false;
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (asteroidInterval) {
                clearInterval(asteroidInterval);
                asteroidInterval = null;
            }
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        // ========== –†–ï–ö–û–†–î–´ ==========
        function loadHighScore() {
            const savedScore = localStorage.getItem('cosmicDefenderHighScore');
            gameState.highScore = savedScore ? parseInt(savedScore) : 0;
            document.getElementById('highScoreDisplay').textContent = gameState.highScore;
        }
        
        function saveHighScore() {
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
                localStorage.setItem('cosmicDefenderHighScore', gameState.highScore);
                document.getElementById('highScoreDisplay').textContent = gameState.highScore;
                return true;
            }
            return false;
        }
        
        function checkHighScore() {
            if (gameState.score > gameState.highScore) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                gameState.highScore = gameState.score;
                localStorage.setItem('cosmicDefenderHighScore', gameState.highScore);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∏–≥—Ä–µ
                showHighScoreNotification();
            }
        }
        
        function showHighScoreNotification() {
            // –°–æ–∑–¥–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 204, 0, 0.9);
                color: #000;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 20px;
                font-weight: bold;
                z-index: 1000;
                animation: fadeInOut 2s;
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                    40% { transform: translate(-50%, -50%) scale(1); }
                    80% { opacity: 1; }
                    100% { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            notification.innerHTML = 'üèÜ –ù–û–í–´–ô –†–ï–ö–û–†–î! üèÜ';
            document.getElementById('gameContainer').appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 2000);
        }

        // ========== UI ==========
        function updateGameUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('time').textContent = gameState.time;
        }
        
        function gameOver() {
            stopGame();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ—Ä–¥
            const isNewRecord = saveHighScore();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            setTimeout(() => {
                let message = `üéÆ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!\n\n`;
                message += `–í–∞—à —Å—á—ë—Ç: ${gameState.score}\n`;
                message += `–†–µ–∫–æ—Ä–¥: ${gameState.highScore}\n\n`;
                
                if (isNewRecord) {
                    message += `üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ù–û–í–´–ô –†–ï–ö–û–†–î! üéâ`;
                } else if (gameState.score === gameState.highScore) {
                    message += `üëç –ü–æ–≤—Ç–æ—Ä–∏–ª–∏ —Å–≤–æ–π —Ä–µ–∫–æ—Ä–¥!`;
                } else {
                    message += `–†–µ–∫–æ—Ä–¥ –∫ –ø–æ–±–µ–¥–µ: ${gameState.highScore - gameState.score} –æ—á–∫–æ–≤`;
                }
                
                alert(message);
                returnToMenu();
            }, 500);
        }

        // ========== –ó–ê–ü–£–°–ö ==========
        window.addEventListener('load', () => {
            console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≤–µ—Ä—Å–∏—è:', VERSION);
            
            // Telegram WebApp
            try {
                const tg = window.Telegram?.WebApp;
                if (tg) {
                    tg.expand();
                    tg.enableClosingConfirmation();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
                    tg.setHeaderColor('#0a0a2a');
                    tg.setBackgroundColor('#0a0a2a');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const user = tg.initDataUnsafe?.user;
                    if (user) {
                        const userInfo = document.querySelector('.user-info');
                        userInfo.innerHTML = `
                            <p>üë®‚ÄçüöÄ –ò–≥—Ä–æ–∫: <strong>${user.first_name}</strong></p>
                            <p class="high-score">üèÜ –†–ï–ö–û–†–î: <span id="highScoreDisplay">${gameState.highScore}</span></p>
                            <p style="font-size: 12px; color: #aaa; margin-top: 10px;">
                                –í–µ—Ä—Å–∏—è ${VERSION.split('-')[0]}
                            </p>
                        `;
                    }
                }
            } catch (e) {
                console.log('Telegram –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ—Ä–¥
            loadHighScore();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ –º–µ–Ω—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(() => {
                if (gameState.screen === 'menu') {
                    loadHighScore();
                }
            }, 2000);
        });

        // ========== –§–ò–ö–° –î–õ–Ø –ö–≠–®–ê TELEGRAM ==========
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
        if (window.location.search.indexOf('nocache') === -1) {
            window.location.search = '?nocache=' + Date.now();
        }
    </script>
</body>
</html>
