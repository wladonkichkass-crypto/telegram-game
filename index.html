<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–ò–¶–ï–õ–ò–ô-68: –ì—Ä–∏–±–æ—Ç–µ—Ö-—Ä–æ–≥–∞–ª–∏–∫</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=PT+Mono&family=Philosopher&display=swap');
        
        :root {
            --day-bg: #e8e0c8;
            --night-bg: #1a1a2a;
            --text-day: #3a2c1a;
            --text-night: #d0d0a0;
            --panel-day: #d8d0b8;
            --panel-night: #2a2a3a;
            --accent: #8a4a1a;
            --danger: #c44;
            --success: #4a8a4a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'PT Mono', monospace;
            background: var(--day-bg);
            color: var(--text-day);
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            transition: all 0.5s ease;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path d="M20,50 Q40,20 60,50 T100,50" stroke="%238a6a4a" fill="none"/></svg>');
            min-height: 100vh;
            position: relative;
        }
        
        body.night-mode {
            background: var(--night-bg);
            color: var(--text-night);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><circle cx="20" cy="20" r="3" fill="%2380a0ff"/><circle cx="50" cy="30" r="2" fill="%2380a0ff"/><circle cx="80" cy="20" r="4" fill="%2380a0ff"/></svg>');
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--panel-day);
            border: 2px solid var(--accent);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .night-mode .header {
            background: var(--panel-night);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff6b6b);
            background-size: 600% 100%;
            animation: filmStrip 8s linear infinite;
        }
        
        @keyframes filmStrip {
            0% { background-position: 0% 0; }
            100% { background-position: 600% 0; }
        }
        
        .game-title {
            font-family: 'Philosopher', sans-serif;
            font-size: 24px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        
        .game-title::before {
            content: 'üé¨ ';
        }
        
        .cycle-display {
            text-align: center;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff9a00, #ff6b00);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .night-mode .cycle-display {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            animation: pulseNight 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        @keyframes pulseNight {
            0%, 100% { box-shadow: 0 0 5px #3498db; }
            50% { box-shadow: 0 0 15px #3498db; }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat {
            background: var(--panel-day);
            padding: 10px;
            text-align: center;
            border-left: 4px solid var(--accent);
        }
        
        .night-mode .stat {
            background: var(--panel-night);
            border-left-color: #3498db;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 20px;
        }
        
        .location-card {
            background: var(--panel-day);
            padding: 20px;
            border: 2px solid var(--accent);
            min-height: 300px;
            position: relative;
        }
        
        .night-mode .location-card {
            background: var(--panel-night);
            border-color: #444;
        }
        
        .location-title {
            color: var(--accent);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed currentColor;
        }
        
        .location-description {
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 120px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            background: var(--accent);
            color: white;
            font-family: 'PT Mono', monospace;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .inventory-sidebar {
            background: var(--panel-day);
            padding: 20px;
            border: 2px solid var(--accent);
        }
        
        .night-mode .inventory-sidebar {
            background: var(--panel-night);
        }
        
        .inventory-title {
            margin-bottom: 15px;
            color: var(--accent);
        }
        
        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 100px;
            margin-bottom: 20px;
        }
        
        .item {
            padding: 8px 12px;
            background: rgba(255,255,255,0.3);
            border: 1px solid var(--accent);
            font-size: 14px;
            position: relative;
        }
        
        .night-mode .item {
            background: rgba(255,255,255,0.1);
        }
        
        .item-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .event-log {
            background: rgba(0,0,0,0.05);
            padding: 15px;
            margin-top: 20px;
            border-top: 2px solid var(--accent);
            max-height: 200px;
            overflow-y: auto;
        }
        
        .night-mode .event-log {
            background: rgba(255,255,255,0.05);
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-left: 15px;
            border-left: 3px solid var(--accent);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .progress-container {
            margin-top: 20px;
        }
        
        .progress-bar {
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .night-mode .progress-bar {
            background: #333;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s;
        }
        
        .craft-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .craft-modal.active {
            display: flex;
        }
        
        .craft-content {
            background: var(--panel-day);
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .night-mode .craft-content {
            background: var(--panel-night);
        }
        
        .recipe {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border: 1px solid var(--accent);
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .recipe:hover {
            background: rgba(138, 74, 26, 0.1);
        }
        
        .recipe-ingredients, .recipe-result {
            display: flex;
            gap: 5px;
        }
        
        .diag-negative {
            color: var(--danger);
            font-weight: bold;
        }
        
        .diag-positive {
            color: var(--success);
            font-weight: bold;
        }
        
        .flicker {
            animation: flicker 0.3s infinite alternate;
        }
        
        @keyframes flicker {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        
        .warning {
            color: #ff9900;
            animation: warningPulse 1s infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .terminal-text {
            font-family: 'PT Mono', monospace;
            background: black;
            color: #00ff00;
            padding: 10px;
            border: 1px solid #00ff00;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- –î–∏–∞—Ñ–∏–ª—å–º-–ø–æ–ª–æ—Å–∫–∞ —Å–≤–µ—Ä—Ö—É -->
    <div class="film-strip"></div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <div class="game-title">–ú–ò–¶–ï–õ–ò–ô-68</div>
        <div class="cycle-display" id="cycleDisplay">–¶–ò–ö–õ: –î–ï–ù–¨</div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
    <div class="stats">
        <div class="stat">
            <div>–ó–î–û–†–û–í–¨–ï</div>
            <div class="stat-value" id="health">10/10</div>
            <div class="progress-bar">
                <div class="progress-fill" id="healthBar" style="width: 100%"></div>
            </div>
        </div>
        <div class="stat">
            <div>–≠–ù–ï–†–ì–ò–Ø</div>
            <div class="stat-value" id="energy">100/100</div>
            <div class="progress-bar">
                <div class="progress-fill" id="energyBar" style="width: 100%"></div>
            </div>
        </div>
        <div class="stat">
            <div>–£–†–û–í–ï–ù–¨</div>
            <div class="stat-value" id="level">1</div>
            <div class="progress-bar">
                <div class="progress-fill" id="xpBar" style="width: 0%"></div>
            </div>
        </div>
        <div class="stat">
            <div>–î–ï–ù–¨</div>
            <div class="stat-value" id="day">1</div>
            <div>–í—ã–∂–∏–ª: <span id="roomsCleared">0</span> –∫–æ–º–Ω–∞—Ç</div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –õ–æ–∫–∞—Ü–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="location-card">
            <h2 class="location-title" id="locationTitle">–õ–ê–ë–û–†–ê–¢–û–†–ò–Ø 54-–ë</h2>
            <div class="location-description" id="locationDesc">
                <p>–ó–∞–±—Ä–æ—à–µ–Ω–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ù–ò–ò "–ü—Ä–æ–≥—Ä–µ—Å—Å-68". –í –≤–æ–∑–¥—É—Ö–µ –≤–∏—Ç–∞–µ—Ç –∑–∞–ø–∞—Ö –æ–∑–æ–Ω–∞ –∏ —Å—Ç–∞—Ä–æ–π –ø–ª–µ—Å–µ–Ω–∏. –°—Ç–µ–Ω—ã –ø–æ–∫—Ä—ã—Ç—ã —Å—Ç—Ä–∞–Ω–Ω—ã–º–∏ –≥—Ä–∏–±–Ω—ã–º–∏ –∫—É–ª—å—Ç—É—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—É–ª—å—Å–∏—Ä—É—é—Ç –º—è–≥–∫–∏–º —Å–≤–µ—Ç–æ–º. –ù–∞ –≤–µ—Ä—Å—Ç–∞–∫–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.</p>
                <p id="enemyInfo"></p>
            </div>
            
            <div class="action-buttons" id="actionButtons">
                <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="event-log" id="eventLog">
                <div class="log-entry">üìª <strong>–ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ:</strong> 23 –æ–∫—Ç—è–±—Ä—è 1986. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —Å –º–∏–∫–æ-–Ω–æ—Å–∏—Ç–µ–ª–µ–º –≤—ã—à–µ–ª –∏–∑-–ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è. –ù—É–∂–Ω–æ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞—Ç—å—Å—è, –Ω–æ –≤—ã—Ö–æ–¥—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –ü–æ–ø—Ä–æ–±—É—é —Å–æ–±—Ä–∞—Ç—å —á—Ç–æ-—Ç–æ –∏–∑ —Ö–ª–∞–º–∞...</div>
                <div class="log-entry">üîß <strong>–°–ø—Ä–∞–≤–∫–∞:</strong> –ò—Å–ø–æ–ª—å–∑—É–π –≤–µ—Ä—Å—Ç–∞–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä—É–∂–∏—è. –ù–æ—á—å –æ–ø–∞—Å–Ω–µ–µ –¥–Ω—è!</div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ –∫—Ä–∞—Ñ—Ç -->
        <div class="inventory-sidebar">
            <h3 class="inventory-title">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h3>
            <div class="inventory-items" id="inventory">
                <div class="item">–û—Ç–≤—ë—Ä—Ç–∫–∞ <span class="item-count">2</span></div>
                <div class="item">–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä</div>
                <div class="item">–°–ø–æ—Ä—ã</div>
            </div>
            
            <h3 class="inventory-title">‚öôÔ∏è –ö–†–ê–§–¢</h3>
            <button class="btn" onclick="openCraft()">–û—Ç–∫—Ä—ã—Ç—å –≤–µ—Ä—Å—Ç–∞–∫</button>
            <button class="btn btn-secondary" onclick="rest()">–û—Ç–¥–æ—Ö–Ω—É—Ç—å (-1 –¥–µ–Ω—å)</button>
            
            <div class="progress-container">
                <div>–î–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è:</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="dayProgress" style="width: 60%"></div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.1);">
                <strong>–≠–§–§–ï–ö–¢–´:</strong>
                <div id="effects">–ù–µ—Ç</div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫—Ä–∞—Ñ—Ç–∞ -->
    <div class="craft-modal" id="craftModal">
        <div class="craft-content">
            <h2>–í–ï–†–°–¢–ê–ö –ì–†–ò–ë–û–¢–ï–•–ù–ò–ö–ê</h2>
            <p>–ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä—É–∂–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.</p>
            
            <div id="recipes">
                <!-- –†–µ—Ü–µ–ø—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <button class="btn btn-danger" onclick="closeCraft()" style="margin-top: 20px;">–ó–∞–∫—Ä—ã—Ç—å –≤–µ—Ä—Å—Ç–∞–∫</button>
        </div>
    </div>
    
    <script>
        // =========== –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ===========
        const gameState = {
            health: 10,
            maxHealth: 10,
            energy: 100,
            maxEnergy: 100,
            level: 1,
            xp: 0,
            xpToNext: 50,
            day: 1,
            cycle: 'day', // 'day' –∏–ª–∏ 'night'
            cycleProgress: 0.6, // 0-1
            roomsCleared: 0,
            location: 'lab',
            currentEnemy: null,
            effects: [],
            inventory: {
                '–æ—Ç–≤—ë—Ä—Ç–∫–∞': 2,
                '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä': 1,
                '—Å–ø–æ—Ä—ã': 1,
                '—Ä–∂–∞–≤—ã–π —Ç—Ä–∞–Ω–∑–∏—Å—Ç–æ—Ä': 1
            },
            weapons: [],
            discoveredRecipes: ['spark_staff']
        };
        
        // =========== –ë–ê–ó–ê –î–ê–ù–ù–´–• –ò–ì–†–´ ===========
        const recipes = {
            spark_staff: {
                name: '–ò—Å–∫—Ä—è—â–∏–π –ø–æ—Å–æ—Ö',
                desc: '–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–µ —ç–ª–µ–∫—Ç—Ä–æ—à–æ–∫–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ',
                ingredients: { '–æ—Ç–≤—ë—Ä—Ç–∫–∞': 1, '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä': 1, '—Å–ø–æ—Ä—ã': 1 },
                result: { type: 'weapon', name: '–ò—Å–∫—Ä—è—â–∏–π –ø–æ—Å–æ—Ö', damage: 3, effect: 'stun' }
            },
            fungal_grenade: {
                name: '–ì—Ä–∏–±–Ω–∞—è –≥—Ä–∞–Ω–∞—Ç–∞',
                desc: '–†–∞–∑—Ä—ã–≤–Ω–æ–π –∑–∞—Ä—è–¥ —Å–æ —Å–ø–æ—Ä–∞–º–∏',
                ingredients: { '–±–∞–Ω–∫–∞': 1, '–ø–æ—Ä–æ—Ö': 1, '—Å–ø–æ—Ä—ã': 2 },
                result: { type: 'consumable', name: '–ì—Ä–∏–±–Ω–∞—è –≥—Ä–∞–Ω–∞—Ç–∞', damage: 5, aoe: true }
            },
            myco_armor: {
                name: '–ú–∏–∫–æ-–±—Ä–æ–Ω—è',
                desc: '–õ—ë–≥–∫–∞—è –±—Ä–æ–Ω—è –∏–∑ —Ö–∏—Ç–∏–Ω–∞',
                ingredients: { '–∫–æ–∂–∞': 2, '—Ö–∏—Ç–∏–Ω': 3, '—Å–ø–æ—Ä—ã': 1 },
                result: { type: 'armor', name: '–ú–∏–∫–æ-–±—Ä–æ–Ω—è', defense: 2 }
            },
            bio_scanner: {
                name: '–ë–∏–æ-—Å–∫–∞–Ω–µ—Ä',
                desc: '–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–µ–¥–∫–∏–µ –≥—Ä–∏–±—ã',
                ingredients: { '–ª–∏–Ω–∑–∞': 1, '–º–∏–∫—Ä–æ—Å—Ö–µ–º–∞': 1, '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä': 1 },
                result: { type: 'tool', name: '–ë–∏–æ-—Å–∫–∞–Ω–µ—Ä', effect: 'detect_rare' }
            }
        };
        
        const locations = {
            lab: {
                name: '–õ–ê–ë–û–†–ê–¢–û–†–ò–Ø 54-–ë',
                desc: '–í–∞—à–∞ –±–∞–∑–∞. –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –º–æ–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –∏ —Å–∫—Ä–∞—Ñ—Ç–∏—Ç—å –æ—Ä—É–∂–∏–µ.',
                actions: ['craft', 'rest', 'explore_corridor']
            },
            corridor: {
                name: '–ì–õ–ê–í–ù–´–ô –ö–û–†–ò–î–û–†',
                desc: '–î–ª–∏–Ω–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä —Å –æ–±–≤–∞–ª–∏–≤—à–µ–π—Å—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–æ–π. –ü–æ —Å—Ç–µ–Ω–∞–º –ø–æ–ª–∑—É—Ç —Å–∏–Ω–∏–µ –º–∏—Ü–µ–ª–∏–∞–ª—å–Ω—ã–µ —É–∑–æ—Ä—ã.',
                actions: ['explore_room', 'return_lab', 'listen']
            },
            storage: {
                name: '–°–ö–õ–ê–î –ö–û–ú–ü–û–ù–ï–ù–¢–û–í',
                desc: '–ó–∞–≤–∞–ª–µ–Ω–Ω–æ–µ —Å—Ç–∞—Ä—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –ø–æ–º–µ—â–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ–ª–µ–∑–Ω—ã–π —Ö–ª–∞–º.',
                actions: ['search', 'return_corridor', 'quick_exit']
            },
            greenhouse: {
                name: '–§–ò–¢–û–¢–†–û–ù–ù–ê–Ø',
                desc: '–ó–∞–±—Ä–æ—à–µ–Ω–Ω–∞—è –æ—Ä–∞–Ω–∂–µ—Ä–µ—è. –ì—Ä–∏–±—ã –∑–¥–µ—Å—å —Ä–∞—Å—Ç—É—Ç –æ—Å–æ–±–µ–Ω–Ω–æ –±—É–π–Ω–æ.',
                actions: ['collect_fungi', 'return_corridor', 'hide']
            }
        };
        
        const enemies = {
            yeast: {
                name: '–®–ê–ì–ê–Æ–©–ò–ï –î–†–û–ñ–ñ–ò',
                desc: '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∏–∏ –¥—Ä–æ–∂–∂–µ–π, –ø–µ—Ä–µ–¥–≤–∏–≥–∞—é—â–∏–µ—Å—è –∞–º—ë–±–æ–æ–±—Ä–∞–∑–Ω–æ.',
                health: 8,
                damage: 2,
                xp: 10,
                loot: ['—Å–ø–æ—Ä—ã', '—Ñ–µ—Ä–º–µ–Ω—Ç'],
                dayOnly: true
            },
            vine: {
                name: '–õ–û–í–ß–ê–Ø –õ–ò–ê–ù–ê',
                desc: '–ë—ã—Å—Ç—Ä—ã–π —Ö–∏—â–Ω—ã–π –º–∏—Ü–µ–ª–∏–π —Å —â—É–ø–∞–ª—å—Ü–∞–º–∏.',
                health: 12,
                damage: 4,
                xp: 20,
                loot: ['—Ö–∏—Ç–∏–Ω', '—Å–ø–æ—Ä—ã', '—è–¥—Ä–æ –ª–∏–∞–Ω—ã'],
                nightOnly: true
            },
            golem: {
                name: '–ú–ò–ö–û-–ì–û–õ–ï–ú',
                desc: '–°–∫–æ–ø–ª–µ–Ω–∏–µ –≥—Ä–∏–±–æ–≤, –ø—Ä–∏–Ω—è–≤—à–µ–µ –≥—É–º–∞–Ω–æ–∏–¥–Ω—É—é —Ñ–æ—Ä–º—É. –û—á–µ–Ω—å –æ–ø–∞—Å–Ω–æ!',
                health: 25,
                damage: 6,
                xp: 50,
                loot: ['—è–¥—Ä–æ –ª–∏–∞–Ω—ã', '—Ö–∏—Ç–∏–Ω', '—Ä–µ–¥–∫–∏–µ —Å–ø–æ—Ä—ã', '–∫—Ä–∏—Å—Ç–∞–ª–ª'],
                boss: true
            }
        };
        
        // =========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ===========
        function updateDisplay() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('health').textContent = `${gameState.health}/${gameState.maxHealth}`;
            document.getElementById('energy').textContent = `${gameState.energy}/${gameState.maxEnergy}`;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('roomsCleared').textContent = gameState.roomsCleared;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
            document.getElementById('healthBar').style.width = `${(gameState.health / gameState.maxHealth) * 100}%`;
            document.getElementById('energyBar').style.width = `${(gameState.energy / gameState.maxEnergy) * 100}%`;
            document.getElementById('xpBar').style.width = `${(gameState.xp / gameState.xpToNext) * 100}%`;
            document.getElementById('dayProgress').style.width = `${gameState.cycleProgress * 100}%`;
            
            // –¶–∏–∫–ª –¥–Ω—è/–Ω–æ—á–∏
            const cycleText = gameState.cycle === 'day' ? '–î–ï–ù–¨' : '–ù–û–ß–¨';
            document.getElementById('cycleDisplay').textContent = `–¶–ò–ö–õ: ${cycleText}`;
            
            // –ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º
            if (gameState.cycle === 'night') {
                document.body.classList.add('night-mode');
            } else {
                document.body.classList.remove('night-mode');
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã
            const effectsEl = document.getElementById('effects');
            if (gameState.effects.length > 0) {
                effectsEl.innerHTML = gameState.effects.map(e => `‚Ä¢ ${e}`).join('<br>');
            } else {
                effectsEl.textContent = '–ù–µ—Ç';
            }
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            updateInventoryDisplay();
        }
        
        function updateInventoryDisplay() {
            const inventoryEl = document.getElementById('inventory');
            inventoryEl.innerHTML = '';
            
            for (const [item, count] of Object.entries(gameState.inventory)) {
                const itemEl = document.createElement('div');
                itemEl.className = 'item';
                itemEl.textContent = item;
                if (count > 1) {
                    const countEl = document.createElement('span');
                    countEl.className = 'item-count';
                    countEl.textContent = count;
                    itemEl.appendChild(countEl);
                }
                inventoryEl.appendChild(itemEl);
            }
        }
        
        function logEvent(text, type = 'info') {
            const logEl = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            let icon = 'üìù';
            if (type === 'combat') icon = '‚öîÔ∏è';
            if (type === 'danger') icon = '‚ö†Ô∏è';
            if (type === 'loot') icon = 'üéÅ';
            if (type === 'craft') icon = '‚öôÔ∏è';
            if (type === 'level') icon = '‚≠ê';
            
            entry.innerHTML = `${icon} <strong>${type.toUpperCase()}:</strong> ${text}`;
            
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            while (logEl.children.length > 8) {
                logEl.removeChild(logEl.firstChild);
            }
        }
        
        function changeLocation(locId) {
            gameState.location = locId;
            const loc = locations[locId];
            
            document.getElementById('locationTitle').textContent = loc.name;
            document.getElementById('locationDesc').innerHTML = `<p>${loc.desc}</p>`;
            
            // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–∞–≥–µ
            document.getElementById('enemyInfo').innerHTML = '';
            
            // –°–ª—É—á–∞–π–Ω—ã–π –≤—Ä–∞–≥ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ª–æ–∫–∞—Ü–∏—è—Ö
            if (Math.random() > 0.6 && locId !== 'lab') {
                spawnEnemy();
            }
            
            updateActions();
            updateDisplay();
        }
        
        function spawnEnemy() {
            let availableEnemies = [];
            
            if (gameState.cycle === 'day') {
                availableEnemies = Object.values(enemies).filter(e => e.dayOnly && !e.boss);
            } else {
                availableEnemies = Object.values(enemies).filter(e => !e.dayOnly || e.nightOnly);
            }
            
            // 10% —à–∞–Ω—Å –Ω–∞ –±–æ—Å—Å–∞ –Ω–æ—á—å—é
            if (gameState.cycle === 'night' && Math.random() > 0.9) {
                availableEnemies = Object.values(enemies).filter(e => e.boss);
            }
            
            if (availableEnemies.length > 0) {
                const enemy = availableEnemies[Math.floor(Math.random() * availableEnemies.length)];
                gameState.currentEnemy = { ...enemy, currentHealth: enemy.health };
                
                const enemyInfo = document.getElementById('enemyInfo');
                enemyInfo.innerHTML = `
                    <div class="terminal-text">
                        <div class="warning">‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ê –£–ì–†–û–ó–ê!</div>
                        <strong>${enemy.name}</strong><br>
                        ${enemy.desc}<br>
                        –ó–¥–æ—Ä–æ–≤—å–µ: ${enemy.currentHealth}/${enemy.health}
                    </div>
                `;
                
                logEvent(`–ü–æ—è–≤–∏–ª—Å—è ${enemy.name}!`, 'danger');
                updateActions();
            }
        }
        
        function updateActions() {
            const buttonsEl = document.getElementById('actionButtons');
            buttonsEl.innerHTML = '';
            
            const loc = locations[gameState.location];
            
            loc.actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                
                switch(action) {
                    case 'craft':
                        btn.textContent = '‚öôÔ∏è –û—Ç–∫—Ä—ã—Ç—å –≤–µ—Ä—Å—Ç–∞–∫';
                        btn.onclick = openCraft;
                        break;
                    case 'rest':
                        btn.textContent = 'üí§ –û—Ç–¥–æ—Ö–Ω—É—Ç—å (-10 —ç–Ω–µ—Ä–≥–∏–∏, +5 –∑–¥–æ—Ä–æ–≤—å—è)';
                        btn.onclick = rest;
                        btn.disabled = gameState.energy < 10;
                        break;
                    case 'explore_corridor':
                        btn.textContent = gameState.cycle === 'night' ? 'üåå –í—ã–π—Ç–∏ –≤ –∫–æ—Ä–∏–¥–æ—Ä (–û–ü–ê–°–ù–û!)' : 'üö™ –í—ã–π—Ç–∏ –≤ –∫–æ—Ä–∏–¥–æ—Ä';
                        btn.onclick = () => changeLocation('corridor');
                        if (gameState.cycle === 'night') {
                            btn.className += ' btn-danger';
                        }
                        break;
                    case 'explore_room':
                        btn.textContent = 'üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É';
                        btn.onclick = exploreRoom;
                        break;
                    case 'return_lab':
                        btn.textContent = 'üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é';
                        btn.onclick = () => changeLocation('lab');
                        break;
                    case 'search':
                        btn.textContent = 'üîé –û–±—ã—Å–∫–∞—Ç—å —Å–∫–ª–∞–¥';
                        btn.onclick = searchStorage;
                        break;
                    case 'return_corridor':
                        btn.textContent = 'üö∂‚Äç‚ôÇÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∏–¥–æ—Ä';
                        btn.onclick = () => changeLocation('corridor');
                        break;
                    case 'listen':
                        btn.textContent = 'üëÇ –ü—Ä–∏—Å–ª—É—à–∞—Ç—å—Å—è';
                        btn.onclick = listen;
                        break;
                    case 'collect_fungi':
                        btn.textContent = 'üçÑ –°–æ–±—Ä–∞—Ç—å –≥—Ä–∏–±—ã';
                        btn.onclick = collectFungi;
                        break;
                    case 'quick_exit':
                        btn.textContent = 'üèÉ‚Äç‚ôÇÔ∏è –ë—ã—Å—Ç—Ä–æ —É–π—Ç–∏';
                        btn.onclick = () => changeLocation('corridor');
                        btn.className += ' btn-danger';
                        break;
                    case 'hide':
                        btn.textContent = 'üï≥Ô∏è –°–ø—Ä—è—Ç–∞—Ç—å—Å—è';
                        btn.onclick = hide;
                        break;
                }
                
                buttonsEl.appendChild(btn);
            });
            
            // –ö–Ω–æ–ø–∫–∏ –±–æ—è, –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–∞–≥
            if (gameState.currentEnemy) {
                const attackBtn = document.createElement('button');
                attackBtn.className = 'btn btn-danger';
                attackBtn.textContent = '‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å –≤—Ä–∞–≥–∞';
                attackBtn.onclick = attackEnemy;
                buttonsEl.prepend(attackBtn);
                
                const fleeBtn = document.createElement('button');
                fleeBtn.className = 'btn btn-secondary';
                fleeBtn.textContent = 'üèÉ‚Äç‚ôÇÔ∏è –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–±–µ–∂–∞—Ç—å';
                fleeBtn.onclick = flee;
                buttonsEl.prepend(fleeBtn);
            }
        }
        
        // =========== –ò–ì–†–û–í–´–ï –ú–ï–•–ê–ù–ò–ö–ò ===========
        function attackEnemy() {
            if (!gameState.currentEnemy) return;
            
            const enemy = gameState.currentEnemy;
            
            // –ü—Ä–æ—Å—Ç–æ–π —É—Ä–æ–Ω
            const playerDamage = 2 + (gameState.level * 0.5);
            enemy.currentHealth -= Math.floor(playerDamage);
            
            logEvent(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${Math.floor(playerDamage)} —É—Ä–æ–Ω–∞ ${enemy.name}!`, 'combat');
            
            // –ö–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞
            if (enemy.currentHealth > 0) {
                gameState.health -= enemy.damage;
                logEvent(`${enemy.name} –∫–æ–Ω—Ç—Ä–∞—Ç–∞–∫–æ–≤–∞–ª –∏ –Ω–∞–Ω—ë—Å ${enemy.damage} —É—Ä–æ–Ω–∞!`, 'combat');
                
                if (gameState.health <= 0) {
                    gameOver();
                    return;
                }
            } else {
                // –ü–æ–±–µ–¥–∞!
                logEvent(`–í—ã –ø–æ–±–µ–¥–∏–ª–∏ ${enemy.name}! –ü–æ–ª—É—á–µ–Ω–æ ${enemy.xp} –æ–ø—ã—Ç–∞.`, 'combat');
                
                // –ù–∞–≥—Ä–∞–¥–∞
                gameState.xp += enemy.xp;
                enemy.loot.forEach(item => {
                    addToInventory(item, 1);
                    logEvent(`–ù–∞–π–¥–µ–Ω–æ: ${item}`, 'loot');
                });
                
                gameState.roomsCleared++;
                gameState.currentEnemy = null;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
                checkLevelUp();
            }
            
            updateDisplay();
            updateActions();
        }
        
        function flee() {
            if (!gameState.currentEnemy) return;
            
            const successChance = gameState.cycle === 'night' ? 0.4 : 0.7;
            
            if (Math.random() < successChance) {
                logEvent('–í—ã —É—Å–ø–µ—à–Ω–æ —Å–±–µ–∂–∞–ª–∏!', 'combat');
                gameState.currentEnemy = null;
            } else {
                logEvent('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–±–µ–∂–∞—Ç—å! –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç.', 'danger');
                gameState.health -= gameState.currentEnemy.damage;
                
                if (gameState.health <= 0) {
                    gameOver();
                    return;
                }
            }
            
            updateDisplay();
            updateActions();
        }
        
        function rest() {
            if (gameState.energy >= 10) {
                gameState.energy -= 10;
                gameState.health = Math.min(gameState.maxHealth, gameState.health + 5);
                gameState.day++;
                
                // –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–∏–∫–ª–∞
                gameState.cycleProgress += 0.3;
                if (gameState.cycleProgress >= 1) {
                    gameState.cycleProgress = 0;
                    gameState.cycle = gameState.cycle === 'day' ? 'night' : 'day';
                    logEvent(`–ù–∞—Å—Ç—É–ø–∏–ª ${gameState.cycle === 'day' ? '–¥–µ–Ω—å' : '–≤–µ—á–µ—Ä'}!`, 'info');
                }
                
                logEvent('–í—ã –æ—Ç–¥–æ—Ö–Ω—É–ª–∏. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 5 –∑–¥–æ—Ä–æ–≤—å—è.', 'info');
                updateDisplay();
            }
        }
        
        function exploreRoom() {
            if (gameState.energy < 15) {
                logEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!', 'danger');
                return;
            }
            
            gameState.energy -= 15;
            gameState.cycleProgress += 0.1;
            
            const outcomes = [
                { type: 'nothing', text: '–ö–æ–º–Ω–∞—Ç–∞ –ø—É—Å—Ç–∞. –¢–æ–ª—å–∫–æ –ø—ã–ª—å –¥–∞ –ø–∞—É—Ç–∏–Ω–∞.' },
                { type: 'loot', text: '–í—ã –Ω–∞—à–ª–∏ —Å—Ç–∞—Ä—ã–π —è—â–∏–∫ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏!', items: ['–æ—Ç–≤—ë—Ä—Ç–∫–∞', '–≥–∞–µ—á–Ω—ã–π –∫–ª—é—á', '–ø–∞—è–ª—å–Ω–∏–∫'] },
                { type: 'enemy', text: '–í –∫–æ–º–Ω–∞—Ç–µ –∑–∞—Ç–∞–∏–ª—Å—è –≤—Ä–∞–≥!' },
                { type: 'event', text: '–í—ã –Ω–∞—à–ª–∏ —Å—Ç–∞—Ä—ã–π –∂—É—Ä–Ω–∞–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π. +20 –æ–ø—ã—Ç–∞.', xp: 20 },
                { type: 'trap', text: '–í—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å—Ç–∞—Ä—É—é –ª–æ–≤—É—à–∫—É! -3 –∑–¥–æ—Ä–æ–≤—å—è.', damage: 3 }
            ];
            
            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
            
            if (outcome.type === 'loot') {
                const item = outcome.items[Math.floor(Math.random() * outcome.items.length)];
                addToInventory(item, 1);
                logEvent(`${outcome.text} –ü–æ–ª—É—á–µ–Ω–æ: ${item}`, 'loot');
            } else if (outcome.type === 'enemy') {
                spawnEnemy();
                logEvent(outcome.text, 'danger');
            } else if (outcome.type === 'event') {
                gameState.xp += outcome.xp;
                logEvent(outcome.text, 'info');
                checkLevelUp();
            } else if (outcome.type === 'trap') {
                gameState.health -= outcome.damage;
                logEvent(outcome.text, 'danger');
                
                if (gameState.health <= 0) {
                    gameOver();
                    return;
                }
            } else {
                logEvent(outcome.text, 'info');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω—ã —Ü–∏–∫–ª–∞
            if (gameState.cycleProgress >= 1) {
                gameState.cycleProgress = 0;
                gameState.cycle = gameState.cycle === 'day' ? 'night' : 'day';
                logEvent(`–ù–∞—Å—Ç—É–ø–∏–ª ${gameState.cycle === 'day' ? '–¥–µ–Ω—å' : '–≤–µ—á–µ—Ä'}!`, 'info');
            }
            
            updateDisplay();
        }
        
        function searchStorage() {
            if (gameState.energy < 20) {
                logEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'danger');
                return;
            }
            
            gameState.energy -= 20;
            
            const foundItems = [
                { name: '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä', chance: 0.7 },
                { name: '–º–∏–∫—Ä–æ—Å—Ö–µ–º–∞', chance: 0.4 },
                { name: '–ª–∏–Ω–∑–∞', chance: 0.3 },
                { name: '—Ä–µ–¥–∫–∏–µ —Å–ø–æ—Ä—ã', chance: 0.2 },
                { name: '–∫—Ä–∏—Å—Ç–∞–ª–ª', chance: 0.1 }
            ];
            
            let found = false;
            foundItems.forEach(item => {
                if (Math.random() < item.chance) {
                    addToInventory(item.name, 1);
                    logEvent(`–ù–∞–π–¥–µ–Ω: ${item.name}`, 'loot');
                    found = true;
                }
            });
            
            if (!found) {
                logEvent('–ù–∏—á–µ–≥–æ —Ü–µ–Ω–Ω–æ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.', 'info');
            }
            
            updateDisplay();
        }
        
        function collectFungi() {
            if (gameState.energy < 15) {
                logEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'danger');
                return;
            }
            
            gameState.energy -= 15;
            
            const fungi = [
                { name: '—Å–ø–æ—Ä—ã', count: 2 },
                { name: '—Ö–∏—Ç–∏–Ω', count: 1 },
                { name: '—è–¥—Ä–æ –ª–∏–∞–Ω—ã', count: gameState.cycle === 'night' ? 1 : 0 }
            ];
            
            fungi.forEach(f => {
                if (f.count > 0) {
                    addToInventory(f.name, f.count);
                    logEvent(`–°–æ–±—Ä–∞–Ω–æ: ${f.name} x${f.count}`, 'loot');
                }
            });
            
            // 30% —à–∞–Ω—Å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –≤—Ä–∞–≥–∞ –≤ –æ—Ä–∞–Ω–∂–µ—Ä–µ–µ
            if (Math.random() < 0.3) {
                spawnEnemy();
            }
            
            updateDisplay();
        }
        
        function listen() {
            gameState.energy -= 5;
            
            const sounds = [
                '–¢–∏—à–∏–Ω–∞... —Å–ª–∏—à–∫–æ–º —Ç–∏—Ö–æ.',
                '–°–ª—ã—à–µ–Ω –¥–∞–ª—ë–∫–∏–π —Å–∫—Ä–µ–∂–µ—Ç –º–µ—Ç–∞–ª–ª–∞.',
                '–ö–∞–ø–∞–µ—Ç –≤–æ–¥–∞ –≥–¥–µ-—Ç–æ –≤ —Ç—Ä—É–±–∞—Ö.',
                '–®—ë–ø–æ—Ç... –∏–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤–µ—Ç–µ—Ä?',
                '–ì—É–ª —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞.'
            ];
            
            const sound = sounds[Math.floor(Math.random() * sounds.length)];
            logEvent(`–í—ã –ø—Ä–∏—Å–ª—É—à–∏–≤–∞–µ—Ç–µ—Å—å: ${sound}`, 'info');
            
            updateDisplay();
        }
        
        function hide() {
            gameState.energy -= 10;
            logEvent('–í—ã —Å–ø—Ä—è—Ç–∞–ª–∏—Å—å –≤ —Ç–µ–Ω–∏. –í—Ä–∞–≥–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∞—Ç –≤–∞—Å.', 'info');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏
            gameState.effects.push('–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å (1 —Ö–æ–¥)');
            
            updateDisplay();
        }
        
        // =========== –°–ò–°–¢–ï–ú–ê –ö–†–ê–§–¢–ê ===========
        function openCraft() {
            const modal = document.getElementById('craftModal');
            const recipesEl = document.getElementById('recipes');
            
            recipesEl.innerHTML = '';
            
            Object.entries(recipes).forEach(([id, recipe]) => {
                const recipeEl = document.createElement('div');
                recipeEl.className = 'recipe';
                recipeEl.onclick = () => attemptCraft(id);
                
                // –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã —Å–ª–µ–≤–∞
                const ingredientsEl = document.createElement('div');
                ingredientsEl.className = 'recipe-ingredients';
                
                Object.entries(recipe.ingredients).forEach(([ing, count]) => {
                    const ingEl = document.createElement('span');
                    ingEl.className = 'item';
                    ingEl.textContent = `${ing} x${count}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                    if (!gameState.inventory[ing] || gameState.inventory[ing] < count) {
                        ingEl.style.opacity = '0.5';
                        ingEl.style.textDecoration = 'line-through';
                    }
                    
                    ingredientsEl.appendChild(ingEl);
                });
                
                // –°—Ç—Ä–µ–ª–∫–∞ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ
                const arrow = document.createElement('div');
                arrow.innerHTML = '‚ûî';
                arrow.style.fontSize = '20px';
                arrow.style.textAlign = 'center';
                
                // –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ø—Ä–∞–≤–∞
                const resultEl = document.createElement('div');
                resultEl.className = 'recipe-result';
                
                const resultItem = document.createElement('span');
                resultItem.className = 'item';
                resultItem.textContent = recipe.name;
                resultEl.appendChild(resultItem);
                
                recipeEl.appendChild(ingredientsEl);
                recipeEl.appendChild(arrow);
                recipeEl.appendChild(resultEl);
                
                // –¢–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
                if (gameState.discoveredRecipes.includes(id)) {
                    recipesEl.appendChild(recipeEl);
                }
            });
            
            modal.classList.add('active');
        }
        
        function closeCraft() {
            document.getElementById('craftModal').classList.remove('active');
        }
        
        function attemptCraft(recipeId) {
            const recipe = recipes[recipeId];
            let canCraft = true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            for (const [ing, count] of Object.entries(recipe.ingredients)) {
                if (!gameState.inventory[ing] || gameState.inventory[ing] < count) {
                    canCraft = false;
                    logEvent(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${ing} x${count}`, 'danger');
                    break;
                }
            }
            
            if (canCraft) {
                // –£–±–∏—Ä–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
                for (const [ing, count] of Object.entries(recipe.ingredients)) {
                    gameState.inventory[ing] -= count;
                    if (gameState.inventory[ing] <= 0) {
                        delete gameState.inventory[ing];
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const result = recipe.result;
                if (result.type === 'weapon') {
                    gameState.weapons.push(result);
                    logEvent(`–°–æ–∑–¥–∞–Ω–æ: ${result.name}! –£—Ä–æ–Ω: ${result.damage}`, 'craft');
                } else {
                    addToInventory(result.name, 1);
                    logEvent(`–°–æ–∑–¥–∞–Ω–æ: ${result.name}!`, 'craft');
                }
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã —Å–ª—É—á–∞–π–Ω–æ
                if (Math.random() > 0.7) {
                    const hiddenRecipes = Object.keys(recipes).filter(r => !gameState.discoveredRecipes.includes(r));
                    if (hiddenRecipes.length > 0) {
                        const newRecipe = hiddenRecipes[Math.floor(Math.random() * hiddenRecipes.length)];
                        gameState.discoveredRecipes.push(newRecipe);
                        logEvent(`–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç: ${recipes[newRecipe].name}!`, 'craft');
                    }
                }
                
                updateDisplay();
            }
        }
        
        // =========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===========
        function addToInventory(item, count = 1) {
            if (!gameState.inventory[item]) {
                gameState.inventory[item] = 0;
            }
            gameState.inventory[item] += count;
        }
        
        function checkLevelUp() {
            if (gameState.xp >= gameState.xpToNext) {
                gameState.level++;
                gameState.xp -= gameState.xpToNext;
                gameState.xpToNext = Math.floor(gameState.xpToNext * 1.5);
                
                gameState.maxHealth += 3;
                gameState.health = gameState.maxHealth;
                gameState.maxEnergy += 10;
                gameState.energy = gameState.maxEnergy;
                
                logEvent(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å –≤—ã —É—Ä–æ–≤–µ–Ω—å ${gameState.level}.`, 'level');
                logEvent(`–ú–∞–∫—Å. –∑–¥–æ—Ä–æ–≤—å–µ: +3, –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è: +10`, 'level');
            }
        }
        
        function gameOver() {
            logEvent('üíÄ –í–´ –ü–û–ì–ò–ë–õ–ò! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.', 'danger');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–∏
            setTimeout(() => {
                alert(`–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê\n\n–£—Ä–æ–≤–µ–Ω—å: ${gameState.level}\n–î–Ω–µ–π –≤—ã–∂–∏—Ç–æ: ${gameState.day}\n–ö–æ–º–Ω–∞—Ç –æ—á–∏—â–µ–Ω–æ: ${gameState.roomsCleared}\n\n–ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã!`);
                
                // –°–±—Ä–æ—Å –∏–≥—Ä—ã (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –º—è–≥–∫–∏–π)
                location.reload();
            }, 1000);
        }
        
        // =========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===========
        function initGame() {
            // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                localStorage.setItem('mycelium68_save', JSON.stringify(gameState));
                logEvent('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.', 'info');
            }, 30000);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const save = localStorage.getItem('mycelium68_save');
            if (save) {
                try {
                    const loaded = JSON.parse(save);
                    Object.assign(gameState, loaded);
                    logEvent('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ.', 'info');
                } catch (e) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ');
                }
            }
            
            // –¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–∞ –¥–Ω—è/–Ω–æ—á–∏
            setInterval(() => {
                if (gameState.location !== 'lab') {
                    gameState.cycleProgress += 0.01;
                    
                    if (gameState.cycleProgress >= 1) {
                        gameState.cycleProgress = 0;
                        gameState.cycle = gameState.cycle === 'day' ? 'night' : 'day';
                        gameState.day++;
                        logEvent(`–ù–∞—Å—Ç—É–ø–∏–ª ${gameState.cycle === 'day' ? '–¥–µ–Ω—å' : '–Ω–æ—á—å'}! –î–µ–Ω—å ${gameState.day}.`, 'info');
                        
                        // –ù–æ—á—å—é —ç–Ω–µ—Ä–≥–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –≤–Ω–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏
                        if (gameState.cycle === 'night' && gameState.location !== 'lab') {
                            gameState.energy -= 5;
                            if (gameState.energy <= 0) {
                                gameState.energy = 0;
                                logEvent('–í—ã —Å–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª–∏! –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é.', 'danger');
                            }
                        }
                    }
                    
                    updateDisplay();
                }
            }, 3000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.getElementById('craftModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCraft();
                }
            });
            
            // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è
            changeLocation('lab');
            updateDisplay();
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>
